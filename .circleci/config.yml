version: 2.1

jobs:
  test-and-build:
    docker:
      - image: cimg/node:20.11
    environment:
      NEXT_PUBLIC_SUPABASE_URL: $NEXT_PUBLIC_SUPABASE_URL
      NEXT_PUBLIC_SUPABASE_ANON_KEY: $NEXT_PUBLIC_SUPABASE_ANON_KEY
      NODE_ENV: production
    steps:
      - checkout
      - run:
          name: Install dependencies
          command: npm ci
      - run:
          name: Run tests (falls vorhanden)
          command: npm test || true
      - run:
          name: Build Next.js
          command: npm run build
      - store_artifacts:
          path: .next
          destination: build

workflows:
  version: 2
  build_and_verify:
    jobs:
      - test-and-build